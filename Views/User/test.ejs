1<%- include("../../Views/Partials/User/headerLand") %>

<head>
  <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
  <link rel="stylesheet" href="/User/assets/css/bootstrap.min.css">
  <link rel="stylesheet" href="/User/assets/css/style.css">
</head>

<body>
  <div class="page-wrapper">
    <main class="main">
      <div class="page-header text-center" style="background-image: url('User/assets/images/banners/2024-Chevrolet-Corvette-Z06-GT3.R-001-1440w.jpg')">
        <div class="container">
          <h1 class="page-title">Shopping Cart<span></span></h1>
        </div><!-- End .container -->
      </div><!-- End .page-header -->
      <nav aria-label="breadcrumb" class="breadcrumb-nav">
        <div class="container">
          <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="/">Home</a></li>
            <li class="breadcrumb-item"><a href="#">Shop</a></li>
            <li class="breadcrumb-item active" aria-current="page">Shopping Cart</li>
          </ol>
        </div><!-- End .container -->
      </nav><!-- End .breadcrumb-nav -->

      <div class="page-content">
        <div class="cart">
          <div class="container">
            <div class="row">
              <div class="col-lg-9">
                <table class="table table-cart table-mobile">
                  <thead>
                    <tr>
                      <th>
                        <p><b>Product</b></p>
                      </th>
                      <th>
                        <p><b>Price</b></p>
                        </p>
                      </th>
                      <th>
                        <p><b>Quantity</b></p>
                      </th>
                      <th>
                        <p><b>Total</b></p>
                      </th>
                      <th>
                        <p></p>
                      </th>
                    </tr>
                  </thead>
                  <tbody>
                    <% if (cart && cart.items.length > 0) { %>
                    <% cart.items.forEach(item => { %>
                    <tr class="cart-item">
                      <td class="product-col">
                        <div class="product">
                          <figure class="product-media">
                            <a href="#">
                              <img src="<%= item.productId.productImage[0] %>" alt="Product image">
                            </a>
                          </figure>
                          <h3 class="product-title">
                            <a href="#"><%= item.productId.productName %> - <%= item.variantName %> (<%= item.scale %>)</a>
                          </h3>
                        </div>
                      </td>

                      <!-- price -->
                      <td class="price-col itemSaleprice">₹<%= item.salePrice %></td>

                      <!-- quantity -->
                      <td class="quantity-col">
                        <div class="cart-product-quantity">
                          <input type="number" class="form-control cartQuantity" value ="<%= item.quantity %>" min="1" max="5" step="1" required oninput="validateQuantity(this)">
                        </div>
                      </td>

                      <!-- total for this row -->
                      <td class="total-col totalPrice">₹<%= item.totalProductprice %></td>

                      <!-- remove -->
                      <td class="remove-col">
                        <button class="btn btn-outline-dark-2 removeCart" data-product-id="<%= item.productId._id %>"
                           style="margin-left: 15px;"> Remove</button>
                      </td>
                    </tr>

                    <% }) %>
                    <% } else { %>
                    <tr>
                      <td colspan="5" class="text-center">
                        <div class="empty-cart">
                          <h2><%= emptyMessage || "Your cart is empty" %></h2>
                          <a href="/shopPage" class="btn btn-outline-primary-2 mt-3">Continue Shopping</a>
                        </div>
                      </td>
                    </tr>
                    <% } %>
                  </tbody>
                </table><!-- End .table table-wishlist -->

                <div class="cart-bottom">
                  <div class="cart-discount">
                    <form action="#">
                      <div class="input-group">
                        <input type="text" class="form-control" required placeholder="coupon code">
                        <div class="input-group-append">
                          <button class="btn btn-outline-primary-2" type="submit"><i class="icon-long-arrow-right"></i></button>
                        </div><!-- .End .input-group-append -->
                      </div><!-- End .input-group -->
                    </form>
                  </div><!-- End .cart-discount -->

                </div><!-- End .cart-bottom -->
              </div><!-- End .col-lg-9 -->
              <aside class="col-lg-3">
                <div class="summary summary-cart">
                  <h3 class="summary-title">Cart Total</h3><!-- End .summary-title -->

                  <table class="table table-summary">
                    <tbody>
                      <tr>
                        <td colspan="2">
                          <span id="shippingNote" class="<%= TotalAmount >= 1999 ? 'text-success' : 'text-decoration-line-through' %>">
                            Free Shipping on purchase above ₹1999/-
                          </span>
                        </td>
                      </tr>
                      <tr class="summary-subtotal">
                        <td>Subtotal:</td>
                        <td></td>
                      </tr><!-- End .summary-subtotal -->

                      <tr>
                        <td colspan="2">
                          <span id="shippingNote" class="<%= TotalAmount >= 1999 ? 'text-success' : 'text-decoration-line-through' %>">
                            Cash On Delivery Available.
                          </span>
                        </td>
                      </tr>

                      <tr class="summary-total">
                        <td>TotalAmount:</td>
                        <td>
                        <td></td>
                        </td>
                      </tr><!-- End .summary-total -->
                    </tbody>
                  </table><!-- End .table table-summary -->
                  <% if (cart && cart.items.length > 0) { %>
                  <a href="/checkout" class="btn btn-outline-primary-2 btn-order btn-block">
                    PROCEED TO CHECKOUT
                  </a>
                  <% } else { %>
                  <a href="#" class="btn btn-outline-secondary btn-order btn-block disabled" tabindex="-1" aria-disabled="true">
                    PROCEED TO CHECKOUT
                  </a>
                  <% } %>
                  <!-- <a href="/checkout" class="btn btn-outline-primary-2 btn-order btn-block">PROCEED TO CHECKOUT</a> -->
                </div><!-- End .summary -->

                <a href="/shopPage" class="btn btn-outline-dark-2 btn-block mb-3"><span>CONTINUE SHOPPING</span><i class="icon-refresh"></i></a>
              </aside><!-- End .col-lg-3 -->
            </div><!-- End .row -->
          </div><!-- End .container -->
        </div><!-- End .cart -->
      </div><!-- End .page-content -->
    </main><!-- End .main -->

  </div><!-- End .page-wrapper -->
  <button id="scroll-top" title="Back to Top"><i class="icon-arrow-up"></i></button>

  <!-- Mobile Menu -->
  <div class="mobile-menu-overlay"></div><!-- End .mobil-menu-overlay -->

  <!-- Plugins JS File -->
  <script src="assets/js/jquery.min.js"></script>
  <script src="assets/js/bootstrap.bundle.min.js"></script>
  <script src="assets/js/jquery.hoverIntent.min.js"></script>
  <script src="assets/js/jquery.waypoints.min.js"></script>
  <script src="assets/js/superfish.min.js"></script>
  <script src="assets/js/owl.carousel.min.js"></script>
  <script src="assets/js/bootstrap-input-spinner.js"></script>
  <!-- Main JS File -->
  <script src="assets/js/main.js"></script>
  <script src="/User/assets/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/toastify-js"></script>

  <script>
  // function updateRowTotal(row) {
  //     const priceElement = row.querySelector(".itemSaleprice");
  //     const quantityInput = row.querySelector(".cartQuantity");
  //     const totalElement = row.querySelector(".totalPrice");

  //     const price = parseFloat(priceElement.textContent.replace("₹", "").trim());
  //     const quantity = parseInt(quantityInput.value) || 1;
  //     const total = price * quantity;

  //     totalElement.textContent = "₹" + total.toFixed(2);
  // }

  // function updateGrandTotal() {
  //   let grandTotal = 0;
  //   document.querySelectorAll(".cart-item").forEach(row => {
  //     const totalElement = row.querySelector(".totalPrice");
  //     const total = parseFloat(totalElement.textContent.replace("₹", "").trim());
  //     grandTotal += total;
  //   });
  
  //   // Update subtotal and total in summary
  //   document.querySelector(".summary-subtotal td:last-child").textContent = "₹" + grandTotal.toFixed(2);
  //   document.querySelector(".summary-total td:last-child").textContent =  grandTotal.toFixed(2);
  // }

  // function attachQuantityListeners() {
  //   document.querySelectorAll(".cart-item").forEach(row => {
  //     const quantityInput = row.querySelector(".cartQuantity");

  //     quantityInput.addEventListener("input", () => {
  //       updateRowTotal(row);
  //       updateGrandTotal();
  //     });
  //   });
  // }

// Initial calculation on page load
  // document.addEventListener("DOMContentLoaded", () => {
  //   document.querySelectorAll(".cart-item").forEach(row => updateRowTotal(row));

  //   const savedQuantity = localStorage.getItem('cartQuantity');

  // if (savedQuantity) {
  //   savedQuantity= parseInt(savedQuantity);

  //   if (isNaN(savedQuantity) || 
  //     savedQuantity < parseInt(input.min) ||
  //     savedQuantity > parseInt(input.max)) 
  //    {
  //     input.value = input.min; // reset to min if invalid
  //   } else {
  //     input.value = savedQuantity;
  //   }
  // }
  //   updateGrandTotal();
  //   attachQuantityListeners();
  // });

    // document.querySelectorAll(".removeCart").forEach(button => {
    //   button.addEventListener("click", async () => {
    //     const productId = button.getAttribute("data-product-id");

    //     // SweetAlert confirmation
    //     Swal.fire({
    //       title: "Are you sure?",
    //       text: "This item will be removed from your cart.",
    //       icon: "warning",
    //       showCancelButton: true,
    //       confirmButtonColor: "#d33",
    //       cancelButtonColor: "#3085d6",
    //       confirmButtonText: "Yes, remove it!"
    //     }).then(async (result) => {
    //       if (result.isConfirmed) {
    //         try {
    //           const response = await fetch(`/removeFromCart/${productId}`, {
    //             method: "DELETE",
    //             headers: {
    //               "Content-Type": "application/json"
    //             }
    //           });

    //           const data = await response.json();

    //           if (response.ok) {
    //             button.closest("tr").remove();
    //             // Update the cart badge
    //             document.querySelector(".cart-badge").textContent = data.cartCount;

    //             // Success alert
    //             Swal.fire("Removed!", data.message, "success");
    //           } else {
    //             Swal.fire("Error!", data.message, "error");
    //           }
    //         } catch (error) {
    //           Swal.fire("Error!", "Something went wrong.", "error");
    //         }
    //       }
    //     });
    //   });
    // });
    
  // function validateQuantity(input) {
  //   const min = parseInt(input.min);
  //   const max = parseInt(input.max);
  //   let value = parseInt(input.value);
  
  //   // If input is not a number, reset to min
  //   if (isNaN(value)) {
  //     input.value = min;
  //     return;
  //   }
  
  //   // Clamp value between min and max
  //   if (value < min) {
  //     input.value = min;
  //   } else if (value > max-1) {
  //     input.value = max;
  
  //     // Show Toast only when value exceeds max
  //     Toastify({
  //       text: `Maximum quantity is ${max}`,
  //       duration: 1500,
  //       gravity: "top",
  //       position: "right",
  //       backgroundColor: "#FF0000",
  //       stopOnFocus: true
  //     }).showToast();
  //   }
  //   localStorage.setItem('cartQuantity', input.value);
  // }
  </script>
<script>
// function updateRowTotal(row) {
//   const priceElement = row.querySelector(".itemSaleprice");
//   const quantityInput = row.querySelector(".cartQuantity");
//   const totalElement = row.querySelector(".totalPrice");

//   const price = parseFloat(priceElement.textContent.replace("₹", "").trim());
//   const quantity = parseInt(quantityInput.value) || 1;
//   const total = price * quantity;

//   totalElement.textContent = "₹" + total.toFixed(2);
// }

// function updateGrandTotal() {
//   let grandTotal = 0;
//   document.querySelectorAll(".cart-item").forEach(row => {
//     const totalElement = row.querySelector(".totalPrice");
//     const total = parseFloat(totalElement.textContent.replace("₹", "").trim());
//     grandTotal += total;
//   });

//   // Update subtotal and total in summary
//   document.querySelector(".summary-subtotal td:last-child").textContent = "₹" + grandTotal.toFixed(2);
//   document.querySelector(".summary-total td:last-child").textContent = "₹" + grandTotal.toFixed(2);
// }

// function attachQuantityListeners() {
//   document.querySelectorAll(".cart-item").forEach(row => {
//     const quantityInput = row.querySelector(".cartQuantity");

//     quantityInput.addEventListener("input", () => {
//       validateQuantity(quantityInput);
//       updateRowTotal(row);
//       updateGrandTotal();
//     });
//   });
// }

// Initial calculation on page load
// document.addEventListener("DOMContentLoaded", () => {
//   document.querySelectorAll(".cart-item").forEach(row => {
//     const quantityInput = row.querySelector(".cartQuantity");
//     let savedQuantity = localStorage.getItem("cartQuantity");

//     if (savedQuantity) {
//       savedQuantity = parseInt(savedQuantity);

//       if (
//         isNaN(savedQuantity) ||
//         savedQuantity < parseInt(quantityInput.min) ||
//         savedQuantity > parseInt(quantityInput.max)
//       ) {
//         quantityInput.value = quantityInput.min; // reset to min if invalid
//       } else {
//         quantityInput.value = savedQuantity;
//       }
//     }

//     updateRowTotal(row);
//   });

//   updateGrandTotal();
//   attachQuantityListeners();
// });

document.querySelectorAll(".removeCart").forEach(button => {
  button.addEventListener("click", async () => {
    const productId = button.getAttribute("data-product-id");

    // SweetAlert confirmation
    Swal.fire({
      title: "Are you sure?",
      text: "This item will be removed from your cart.",
      icon: "warning",
      showCancelButton: true,
      confirmButtonColor: "#d33",
      cancelButtonColor: "#3085d6",
      confirmButtonText: "Yes, remove it!"
    }).then(async result => {
      if (result.isConfirmed) {
        try {
          const response = await fetch(`/removeFromCart/${productId}`, {
            method: "DELETE",
            headers: {
              "Content-Type": "application/json"
            }
          });

          const data = await response.json();

          if (response.ok) {
            button.closest("tr").remove();
            // Update the cart badge
            document.querySelector(".cart-badge").textContent = data.cartCount;

            // Success alert
            Swal.fire("Removed!", data.message, "success");
          } else {
            Swal.fire("Error!", data.message, "error");
          }
        } catch (error) {
          Swal.fire("Error!", "Something went wrong.", "error");
        }
      }
    });
  });
});

// function validateQuantity(inputElement) {
//   const min = parseInt(inputElement.min);
//   const max = parseInt(inputElement.max);
//   let value = parseInt(inputElement.value);

//   // If input is not a number, reset to min
//   if (isNaN(value)) {
//     inputElement.value = min;
//     return;
//   }

//   // Clamp value between min and max
//   if (value < min) {
//     inputElement.value = min;
//   } else if (value > max-1) {
//     inputElement.value = max;

//     // Show Toast only when value exceeds max
//     Toastify({
//       text: `Maximum quantity is ${max}`,
//       duration: 1500,
//       gravity: "top",
//       position: "right",
//       backgroundColor: "#FF0000",
//       stopOnFocus: true
//     }).showToast();
//   }

//   // Save to localStorage
//   // localStorage.setItem("cartQuantity", inputElement.value);
// }
//</script>

<script>
  function updateQuantityOnBackend(productId, quantity) {
  fetch("/updateCartQuantity", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ productId, quantity })
  })
    .then(res => res.json())
    .then(data => {
      if (data.success) {
        // Optionally show success toast
        Toastify({ text: "Quantity updated", duration: 500 }).showToast();
      } else {
        Toastify({
          text: data.message || "Failed to update quantity",
          duration: 1500,
          gravity: "top",
          position: "right",
          backgroundColor: "#FF0000"
        }).showToast();
      }
    })
    .catch(() => {
      Toastify({
        text: "Error updating cart",
        duration: 1500,
        gravity: "top",
        position: "right",
        backgroundColor: "#FF0000"
      }).showToast();
    });
}
  function updateRowTotal(row) {
  const priceElement = row.querySelector(".itemSaleprice");
  const quantityInput = row.querySelector(".cartQuantity");
  const totalElement = row.querySelector(".totalPrice");

  const price = parseFloat(priceElement.textContent.replace("₹", "").trim());
  const quantity = parseInt(quantityInput.value) || 1;
  const total = price * quantity;

  totalElement.textContent = "₹" + total.toFixed(2);
}

function updateGrandTotal() {
  let grandTotal = 0;
  document.querySelectorAll(".cart-item").forEach(row => {
    const totalElement = row.querySelector(".totalPrice");
    const total = parseFloat(totalElement.textContent.replace("₹", "").trim());
    grandTotal += total;
  });

  // Update subtotal and total in summary
  document.querySelector(".summary-subtotal td:last-child").textContent = "₹" + grandTotal.toFixed(2);
  document.querySelector(".summary-total td:last-child").textContent = "₹" + grandTotal.toFixed(2);
}

function validateQuantity(inputElement, productId) {
  const min = parseInt(inputElement.min);
  const max = parseInt(inputElement.max);
  let value = parseInt(inputElement.value);

  // If input is not a number, reset to min
  if (isNaN(value)) {
    inputElement.value = min;
    return;
  }

  // Clamp value between min and max
  if (value < min) {
    inputElement.value = min;
  } else if (value > max-1) {
    inputElement.value = max;

    Toastify({
      text: `Maximum quantity is ${max}`,
      duration: 1500,
      gravity: "top",
      position: "right",
      backgroundColor: "#FF0000",
      stopOnFocus: true
    }).showToast();
  }

  //Update backend cart
  updateQuantityOnBackend(productId, inputElement.value);
}


function attachQuantityListeners() {
  document.querySelectorAll(".cart-item").forEach(row => {
    const quantityInput = row.querySelector(".cartQuantity");
    const productId = row.querySelector(".removeCart").dataset.productId;

    quantityInput.addEventListener("change", () => {
      validateQuantity(quantityInput, productId);
      updateRowTotal(row);
      updateGrandTotal();
    });
  });
}

// Initial calculation on page load
document.addEventListener("DOMContentLoaded", () => {
  document.querySelectorAll(".cart-item").forEach(row => updateRowTotal(row));
  updateGrandTotal();
  attachQuantityListeners();
});

</script>

</body>

<%- include("../../Views/Partials/User/footerLand") %>





















// ------------------------------------------prduct detail page----------------------------------


<div class="product-details-top">
  <div class="row">
    <!-- Product Gallery -->
    <div class="col-md-6 position-relative" id="product-gallery-container">
      <div class="product-gallery product-gallery-vertical">
        <div class="row">
          <!-- Offer Badge -->
          <% if (product.productOffer > 0) { %>
            <div class="offer-badge position-absolute bg-danger text-white fw-bold rounded px-2 py-1" 
                 style="top: 10px; left: 10px; font-size: 16px;">
              <%= product.productOffer %>% OFF
            </div>
          <% } %>

      <figure class="product-main-image">
        <img id="product-zoom" src="<%= product.productImage[0] %>" data-zoom-image="<%= product.productImage[0] %>" alt="product image">
        <a href="#" id="btn-product-gallery" class="btn-product-gallery">
          <i class="icon-arrows"></i>
        </a>
      </figure>

      <div id="product-zoom-gallery" class="product-image-gallery">
        <% product.productImage.forEach((image, index) => { %>
          <a class="product-gallery-item <%= index === 0 ? 'active' : '' %>" href="#" data-image="<%= image %>" data-zoom-image="<%= image %>">
            <img src="<%= image %>" alt="product side">
          </a>
        <% }) %>
      </div>
    </div>
  </div>
</div>

<!-- Product Details -->
<div class="col-md-6" id="product-galler-details">
  <div class="product-details">
    <label for="scale">Edition:</label><h3><%= product.edition %></h3>
    <h2 class="product-title" style="font-size: 3.7rem; font-weight: 700; font-family: 'Montserrat';">
      <%= product.productName %>
    </h2>

    <div class="details-filter-row details-row-size">
      <label>Brand:</label><h4><%= product.brand.brandName %></h4>
    </div>

    <div class="ratings-container">
      <div class="ratings">
        <div class="ratings-val" style="width: 80%;"></div>
      </div>
      <a class="ratings-text" href="#product-review-link">( 2 Reviews )</a>
    </div>

    <!-- Price Section -->
    <div class="product-price mt-2">
      <% const selectedVariant = product.variants && product.variants.length > 0 ? product.variants[0] : null; %>
      <% if (product.productOffer > 0 && selectedVariant?.offerPrice > 0) { %>
        <span class="text-muted" style="text-decoration: line-through; font-size: 18px;">
          ₹<%= selectedVariant.salePrice %>
        </span>
        <span class="text-success fw-bold fs-4 ms-2">
          ₹<%= selectedVariant.offerPrice %>
        </span>
      <% } else { %>
        <span class="fs-4 fw-bold text-dark">
          ₹<%= selectedVariant ? selectedVariant.salePrice : 'N/A' %>
        </span>
      <% } %>
    </div>

    <div class="product-content">
      <p class="short-desc"><%= product.description.split(" ").slice(0, 22).join(" ") %>...</p>
      <p class="full-desc" style="display:none;"><%= product.description %></p>
      <button class="toggle-desc-btn">See More..</button>
    </div>

    <!-- Scale Buttons -->
    <div class="details-filter-row details-row-size">
      <label>Scale:</label>
      <div id="scale-buttons" class="btn-group btn-group-toggle" data-toggle="buttons">
        <% product.variants.forEach((variant, index) => { %>
          <button type="button"
            class="btn btn-outline-primary scale-btn <%= index === 0 ? 'active' : '' %>"
            data-variant='<%- JSON.stringify(variant) %>'>
            <%= variant.scale %>
          </button>
        <% }); %>
      </div>
    </div>

    <!-- Stock Badge -->
    <div class="details-filter-row">
      <span id="stock-badge" style="font-weight: bold;font-size: larger;"></span>
    </div>

    <!-- Quantity -->
    <div class="details-filter-row details-row-size">
      <label for="qty">Quantity </label>
      <div class="product-details-quantity">
        <input type="number" id="qty" class="form-control" value="1" min="1" max="5" step="1" required>
      </div>
    </div>

    <!-- Category -->
    <div class="product-cat">
      <span>Category:</span>
      <a href="#"><%= product.category ? product.category.name : '' %></a>,
      <a href="#"><%= product.productName %></a>
    </div>

    <!-- Actions -->
    <div class="product-details-action">
      <a href="#" class="btn-product btn-cart" onclick="addToCart('<%= product._id %>')">
        <span>Add to Cart</span>
      </a>
      <a href="#" class="btn-product btn-wishlist" onclick="addToWishlist('<%= product._id %>')">
        <span>Add to Wishlist</span>
      </a>
    </div>

    <!-- Social Links -->
    <div class="social-icons social-icons-sm">
      <span class="social-label">Share:</span>
      <a href="#" class="social-icon" title="Facebook"><i class="icon-facebook-f"></i></a>
      <a href="#" class="social-icon" title="Twitter"><i class="icon-twitter"></i></a>
      <a href="#" class="social-icon" title="Instagram"><i class="icon-instagram"></i></a>
      <a href="#" class="social-icon" title="Pinterest"><i class="icon-pinterest"></i></a>
    </div>

    <p>Experience premium craftsmanship with AutoMinima’s diecast models. Built for collectors and enthusiasts. Perfect for display or gifting — Precision in Every Scale.</p>
  </div>
</div>

  </div>
</div>













// -------------------------------------------------------------------------------


<body>
    <div class="page-wrapper">
        <main class="main">
        	<div class="page-header text-center" style="background-image: url('assets/images/page-header-bg.jpg')">
        		<div class="container">
        			<h1 class="page-title">Checkout<span></span></h1>
        		</div><!-- End .container -->
        	</div><!-- End .page-header -->
            

                     <!-- ====== Available Coupons Section ====== -->

                    <div class="coupon-section mb-4">
                      <h3 class="coupon-title" onclick="toggleCouponList()" style="cursor: pointer;">
                        Available Coupons 
                        <span id="toggleIcon" class="material-icons" style="font-size: 18px;">view</span>
                      </h3>
                    
                      <div id="couponList" class="coupon-list" style="display: none; max-height: 250px; overflow-y: auto;">
                        <p class="text-muted">Loading coupons...</p>
                      </div>
                    </div>
                    <!-- ====== End Coupon Section ====== -->
0
		                </div><!-- End .col-lg-9 -->
		                		<aside class="col-lg-3">
		                			<div class="summary">
		                				<h3 class="summary-title">Your Orders</h3><!-- End .summary-title -->

                                        <div class="order-section">
                                                <!-- <h2>Your Orders</h2> -->

                                                <div class="order-summary">
                                                    <div class="order-header">
                                                        <span class="col-product">Product</span>
                                                        <span class="col-qty">Qty</span>
                                                        <!-- <span></span> -->
                                                        <span class="col-total">. Total</span>
                                                    </div>
                                                
                                                    <div class="order-items">
                                                        <% cart.items.forEach(item => { %>
                                                            <div class="order-item">
                                                                <span class="product-name">
                                                                    <%= item.productId.productName.split("").slice(0,25).join("") %> ,(<%= item.scale %>)
                                                                </span>
                                                                <span class="product-qty">
                                                                    <%= item.quantity %>
                                                                </span>
                                                                <span class="product-price">
                                                                    ₹ <%= (item.salePrice * item.quantity).toFixed(2) %>
                                                                </span>
                                                            </div>
                                                        <% }) %>
                                                    </div>
                                                
                                                    <div class="order-totals">

                                                        <div class="total-row">
                                                            <span>Festival Offer: 5% OFF</span>
                                                            <span>- ₹ <%= festivalOFF.toFixed(2) %></span>
                                                        </div>

                                                        <div class="total-row">
                                                        <span>Shipping:</span>
                                                          <span class="<%= grandTotal >= 1999 ? 'text-success' : '' %>">
                                                            <%= grandTotal >= 1999 ? "Free shipping" : "Shipping Charge: + ₹120.00" %>
                                                          </span>
                                                        </div>
                                                        
                                                        <div>
                                                          <span class="<%= grandTotal >= 1999 ? 'text-success' : 'text-decoration-line-through text-muted' %>">
                                                            <%= grandTotal >= 1999 ? "Cash-On-Delivery Available" : "COD not-Available" %>
                                                          </span>
                                                        </div>

                                                        <div class="total-row total-final">
                                                            <span>GrandTotal:</span>
                                                            <span>₹<%= grandTotal.toFixed(2) %></span>
                                                        </div>

                                                        <div class="total-row total-final">
                                                          <span>Payment Options:</span>
                                                        </div>

                                                        <div class="payment-options">
                                                          <label class="payment-option">
                                                            <input type="radio" name="paymentMethod" value="Cash-On-Delivery" checked>
                                                            <span>Cash on Delivery</span>
                                                          </label>
                                                        
                                                          <label class="payment-option">
                                                            <input type="radio" name="paymentMethod" value="wallet">
                                                            <span>Wallet</span>
                                                          </label>
                                                        
                                                          <label class="payment-option">
                                                            <input type="radio" name="paymentMethod" value="Online-razorpay">
                                                            <span>Razorpay</span>
                                                          </label>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
		                	    <button type="submit" class="btn btn-outline-primary-2 btn-order btn-block" id="placeOrderBtn">Place Order</button>
										<button type="submit" class="btn btn-outline-primary-2 btn-cancel btn-block" id="cancelOrderBtn">Cancel Order</button>
		                			</div><!-- End .summary -->
		                		</aside><!-- End .col-lg-3 -->
		                	</div><!-- End .row -->
            			</form>
	                </div><!-- End .container -->
                </div><!-- End .checkout -->
            </div><!-- End .page-content -->
        </main><!-- End .main -->
    </div><!-- End .page-wrapper -->


<script>


<script>
  // Toggle show/hide
  function toggleCouponList() {
    const list = document.getElementById("couponList");
    const icon = document.getElementById("toggleIcon");
    const isVisible = list.style.display === "block";
    list.style.display = isVisible ? "none" : "block";
    icon.textContent = isVisible ? "view" : "close";
  }

  // Fetch available coupons
  async function loadAvailableCoupons() {
    try {
      const res = await fetch("/available-coupons");
      const data = await res.json();

      const list = document.getElementById("couponList");
      list.innerHTML = "";

      if (!data.success || data.coupons.length === 0) {
        list.innerHTML = `<p class="text-muted">No coupons available right now.</p>`;
        return;
      }

      data.coupons.forEach(coupon => {
        const item = document.createElement("div");
        item.classList.add("coupon-card");
        item.innerHTML = `
          <div class="coupon-box p-2 border rounded mb-2">
            <div class="d-flex justify-content-between align-items-center">
              <div>
                <h6 class="mb-1 text-uppercase">${coupon.couponCode}</h6>
                <p class="mb-1"><strong>₹${coupon.discountAmount}</strong> off</p>
                <small class="text-secondary">Valid till: ${new Date(coupon.expiryDate).toLocaleDateString()}</small>
              </div>
              <button class="btn btn-sm btn-outline-primary apply-coupon-btn" 
                data-code="${coupon.couponCode}" 
                data-discount="${coupon.discountAmount}">
                Apply
              </button>
            </div>
          </div>
        `;
        list.appendChild(item);
      });

      // Handle coupon apply
      document.querySelectorAll(".apply-coupon-btn").forEach(btn => {
        btn.addEventListener("click", e => {
          const couponCode = e.target.dataset.code;
          const discount = parseFloat(e.target.dataset.discount);

          Swal.fire({
            title: "Apply this coupon?",
            text: `${couponCode} will give you ₹${discount} off.`,
            icon: "question",
            showCancelButton: true,
            confirmButtonText: "Apply",
            cancelButtonText: "Cancel",
          }).then(result => {
            if (result.isConfirmed) {
              applyCoupon(couponCode, discount);
            }
          });
        });
      });

    } catch (error) {
      console.error("Error loading coupons:", error);
      document.getElementById("couponList").innerHTML = `<p class="text-danger">Failed to load coupons.</p>`;
    }
  }

  // Apply coupon logic
  function applyCoupon(code, discount) {
    const totalElem = document.querySelector(".total-final span:last-child");
    const grandTotalText = totalElem.textContent.replace("₹", "").trim();
    let grandTotal = parseFloat(grandTotalText);

    const newTotal = Math.max(0, grandTotal - discount);
    totalElem.textContent = "₹" + newTotal.toFixed(2);

    Swal.fire("Success!", `Coupon "${code}" applied successfully!`, "success");
  }

  // Load coupons on page load
  window.addEventListener("DOMContentLoaded", loadAvailableCoupons);
</script>