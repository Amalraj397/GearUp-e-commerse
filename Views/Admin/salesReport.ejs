<%-include("../../Views/Partials/Admin/header")%>

<style>
  body {
    background-color: #121212;
    color: #f1f1f1;
    font-family: "Poppins", sans-serif;
    margin: 0;
    padding: 20px;
  }

  .sales-report-container {
    max-width: 1200px;
    margin: 25px;
    background: #1e1e1e;
    border-radius: 6px;
    padding: 20px;
    box-shadow: 0 0 12px rgba(255, 102, 0, 0.3);
  }

  .page-title {
    text-align: center;
    color: #ff6600;
    font-size: 28px;
    font-weight: 600;
    margin-bottom: 20px;
  }

  .report-filters {
    display: flex;
    justify-content: center;
    margin-bottom: 30px;
  }

  form {
    display: flex;
    gap: 15px;
    align-items: flex-end;
    flex-wrap: wrap;
  }

  .form-group label {
    display: block;
    font-weight: 500;
    margin-bottom: 5px;
    color: #ccc;
  }

  .form-group input,
  .form-group select {
    padding: 8px 10px;
    border-radius: 6px;
    border: 1px solid #444;
    background: #2c2c2c;
    color: #fff;
    outline: none;
  }

  .btn-primary {
    background: #ff6600;
    border: none;
    color: white;
    padding: 10px 20px;
    border-radius: 6px;
    cursor: pointer;
    font-weight: 500;
    transition: 0.3s ease;
  }

  .btn-primary:hover {
    background: #e65c00;
  }

  .btn-secondary {
    background: #2c2c2c;
    color: #ff6600;
    border: 1px solid #ff6600;
    padding: 10px 18px;
    border-radius: 6px;
    cursor: pointer;
    transition: 0.3s ease;
  }

  .btn-secondary:hover {
    background: #ff6600;
    color: #fff;
  }

  .report-summary {
    display: flex;
    justify-content: space-between;
    gap: 20px;
    margin-bottom: 30px;
    flex-wrap: wrap;
  }

  .summary-item {
    background: #2c2c2c;
    flex: 1;
    text-align: center;
    border-radius: 10px;
    padding: 20px;
    box-shadow: 0 0 10px rgba(255, 102, 0, 0.2);
  }

  .summary-item h3 {
    color: #ff6600;
    font-size: 18px;
    margin-bottom: 8px;
  }

  .report-table {
    width: 100%;
    border-collapse: collapse;
    color: #fff;
  }

  .report-table th {
    background-color: #ff6600;
    color: #fff;
    padding: 10px;
    text-align: center;
  }

  .report-table td {
    background-color: #2c2c2c;
    padding: 10px;
    text-align: center;
    border-bottom: 1px solid #3a3a3a;
  }

  .report-actions {
    display: flex;
    justify-content: center;
    gap: 20px;
    margin-top: 25px;
  }

  .hidden {
    display: none;
  }
</style>


</head>

<body>
  <div class="sales-report-container">
    <h1 class="page-title">SALES REPORT</h1>

    <div class="report-filters">
      <form id="report-filter-form">
        <div class="form-group">
          <label for="date-range">Date Range:</label>
          <select id="date-range" name="dateRange">
            <option value="daily">Daily</option>
            <option value="weekly">Weekly</option>
            <option value="monthly">Monthly</option>
            <option value="yearly">Yearly</option>
            <option value="custom">Custom Date Range</option>
          </select>
        </div>

        <div class="form-group">
          <label for="order-status">Order Status:</label>
          <select id="order-status" name="orderStatus">
            <option value="All">All</option>
            <option value="Pending">Pending</option>
            <option value="Shipped">Shipped</option>
            <option value="Delivered">Delivered</option>
            <option value="Cancelled">Cancelled</option>
            <option value="Returned">Returned</option>
          </select>
        </div>

        <div id="custom-date-range" class="custom-date-range hidden">
          <div class="form-group">
            <label for="start-date">Start Date:</label>
            <input type="date" id="start-date" name="startDate" />
          </div>
          <div class="form-group">
            <label for="end-date">End Date:</label>
            <input type="date" id="end-date" name="endDate" />
          </div>
        </div>

        <button type="submit" class="btn-primary">Generate Report</button>
      </form>
    </div>

    <div class="report-summary">
      <div class="summary-item">
        <h3>Total Orders</h3>
        <p id="sales-count">0</p>
      </div>
      <div class="summary-item">
        <h3>Total Revenue</h3>
        <p id="order-amount">â‚¹0.00</p>
      </div>

    </div>
    <div class="report-summary extra-summary">
      <div class="summary-item">
        <h3>Total Festival Discounts</h3>
        <p id="festival-discount">â‚¹0.00</p>
      </div>
      <div class="summary-item">
        <h3>Total Coupon Discounts</h3>
        <p id="coupon-discount">â‚¹0.00</p>
      </div>
      <div class="summary-item">
        <h3>Total Offer Given</h3>
        <p id="overall-offer">â‚¹0.00</p>
      </div>
    </div>
    <div class="report-table-container">
      <table class="report-table">
        <thead>
          <tr>
            <th>Date</th>
            <th>Order ID</th>
            <th>Total Orders</th>
            <th>Discount</th>
            <th>Coupon</th>
            <th>Total Deduction</th>
            <th>Revenue</th>
          </tr>
        </thead>
        <tbody id="report-data">
          <tr>
            <td colspan="7" style="text-align:center;">No data available</td>
          </tr>
        </tbody>
      </table>
    </div>
    <div class="report-actions">
      <button id="download-pdf" class="btn-secondary">ðŸ“„ Download PDF</button>
      <button id="download-excel" class="btn-secondary">ðŸ“Š Download Excel</button>
    </div>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script>
    document.addEventListener("DOMContentLoaded", function() {
      let type = "";
      let startDate = "";
      let endDate = "";
      let status = "All";

      const dateRangeSelect = document.getElementById("date-range");
      const customDateRange = document.getElementById("custom-date-range");
      const statusSelect = document.getElementById("order-status");

      dateRangeSelect.addEventListener("change", function() {
        customDateRange.classList.toggle("hidden", this.value !== "custom");
      });

      statusSelect.addEventListener("change", function() {
        status = this.value;
      });

      async function fetchReport(type, startDate, endDate, status) {
        try {
          console.log("Fetching report with status:", status);

          const response = await fetch(
            `/admin/salesReport/fetch?type=${type}&startDate=${startDate}&endDate=${endDate}&status=${status}`
          );

          const data = await response.json();

          const tbody = document.getElementById("report-data");

          if (!data.report || data.report.length === 0) {
            tbody.innerHTML = `<tr><td colspan="7" style="text-align:center;">No data available</td></tr>`;
            return;
          }

          tbody.innerHTML = data.report
            .map(
              (row) => `
          <tr>
            <td>${row._id}</td>
            <td>${row.orderIds.join("<br>")}</td>
            <td>${row.totalOrders}</td>
            <td>â‚¹${row.totalFestivalDiscount}</td>
            <td>â‚¹${row.totalCouponDiscount}</td>
            <td>â‚¹${row.totalDiscount}</td>
            <td>â‚¹${row.totalRevenue}</td>
          </tr>`
            )
            .join("");

          document.getElementById("sales-count").textContent =
            data.summary.salesCount;
          document.getElementById("order-amount").textContent = `â‚¹${data.summary.orderAmount}`;
          // document.getElementById("total-discount").textContent = `â‚¹${data.summary.totalDiscount}`;

          document.getElementById("festival-discount").textContent = `â‚¹${data.summary.totalFestivalDiscount}`;
          document.getElementById("coupon-discount").textContent = `â‚¹${data.summary.totalCouponDiscount}`;
          document.getElementById("overall-offer").textContent = `â‚¹${data.summary.totalOfferGiven}`;


        } catch (error) {
          console.error("Error fetching report:", error);
          Swal.fire("Error", "Something went wrong!", "error");
        }
      }

      //report
      document
        .getElementById("report-filter-form")
        .addEventListener("submit", function(e) {
          e.preventDefault();

          type = document.getElementById("date-range").value;
          startDate = document.getElementById("start-date").value;
          endDate = document.getElementById("end-date").value;
          status = document.getElementById("order-status").value;

          if (type === "custom" && (!startDate || !endDate)) {
            Swal.fire("Warning", "Please select both start and end dates!", "warning");
            return;
          }

          fetchReport(type, startDate, endDate, status);
        });

      // pdf
      document.getElementById("download-pdf").addEventListener("click", () => {
        if (type) {
          window.open(
            `/admin/salesReport/pdf?type=${type}&startDate=${startDate}&endDate=${endDate}&status=${status}`,
            "_blank"
          );
        } else {
          Swal.fire("Info", "Please generate a report first.", "info");
        }
      });

      // excel
      document.getElementById("download-excel").addEventListener("click", () => {
        if (type) {
          window.open(
            `/admin/salesReport/excel?type=${type}&startDate=${startDate}&endDate=${endDate}&status=${status}`,
            "_blank"
          );
        } else {
          Swal.fire("Info", "Please generate a report first.", "info");
        }
      });
    });
  </script>
</body>

</html>


<%-include("../../Views/Partials/Admin/footer")%>